</article>
    {{ $image := $.Page.Resources.GetMatch (.Get "src") }}
    {{ if or (gt $image.Width 800) (and (isset .Params "width") (gt $image.Width (.Get "width"))) -}}
        {{ $.Scratch.Set "imgwidth" "800" }}
        {{ if and (isset .Params "width") (lt (.Get "width") 800) -}}
            {{ $.Scratch.Set "imgwidth" (trim (.Get "width") "px") }}
        {{- end }}
        {{ $resized := $image.Resize (printf "%sx Lanczos" ($.Scratch.Get "imgwidth")) }}
        <amp-img src="{{ $resized.Permalink }}" class="figure-img"
            {{- with .Get "alt" }} alt="{{ . }}" {{ end -}} >
    {{ else }}
        <amp-img src="{{ $image.Permalink }}" class="figure-img"
            {{- with .Get "alt" }} alt="{{ . }}" {{ end -}} >
        {{ with (.Get "description") }}<span class="caption">{{ . }}</span>{{ end }}
    {{- end }}
<article class="post side-padding">
